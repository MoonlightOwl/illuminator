<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Illuminator: #CC.RU logs</title>
  <link rel="stylesheet" href="/css/illuminator.css"/>
  <link rel="icon" type="image/x-icon" href="favicon.png" />
</head>
<body>
  <aside id="sidebar">
    <a href="/"><img class="logo" src="/images/logo.png" alt="Illuminator Logo"></a>
    <div class="files">
      <% files.each do |file| %>
        <div class="list filename <% if file == current_file %>active<% end %>">
          <a href="/<%= file %><% if !params["query"].is_a? Nil %>?<%= params["query"] %><% end %>"><%= file %></a>
        </div>
      <% end %>  
    </div>
  </aside>
  <div id="log">
    <div class="header">
      <span class="filename"><%= current_file %></span>
      <a href="/download/<%= current_file %>" class="header-button">raw</a>
    </div>
    <div class="content">
      <div class="messages">
        <% log.messages.each_with_index do |message, i| %>
          <div class="msg <% if message[:nickname] == "***" %>join<% elsif message[:nickname] == "*" %>action<% end %><% if message[:nickname] == highlight %> highlight<% end %>">
            <a id="<%= i %>" class="time" href="#<%= i %>"><%= message[:time] %></a>
            <%= renderer.renderNickname(message[:nickname], params["colorize"]) %>
            <span class="text"><%= renderer.renderLine(message[:text]) %></span>
          </div>
        <% end %> 
      </div>
    </div>
  </div>
  <script type="text/javascript">
    (function() {
      var content = document.getElementsByClassName("content")[0]

      if (window.location.hash)
        content.scrollTop = document.getElementById(window.location.hash.substr(1)).offsetTop;
      else
        content.scrollTop = content.scrollHeight;

      content.addEventListener("click", function(e) {
        if (e.target.className.lastIndexOf("from") === 0) {
          var nickname = e.target.textContent.slice(1, -1)
          window.location.replace('/<%=current_file%>?highlight=' + nickname<% if params["colorize"] %>+ '&colorize=true'<% end %>);
        }
      });
    })();
  </script>
</body>
</html>
